apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: napkinvisuals.napkin.tas.ai
  labels:
    app: napkin-operator
    component: crd
spec:
  group: napkin.tas.ai
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required:
            - content
            properties:
              content:
                type: string
                description: "Text content to visualize"
                minLength: 1
                maxLength: 50000
              format:
                type: string
                description: "Output format"
                enum: ["svg", "png", "ppt"]
                default: "svg"
              style:
                type: object
                properties:
                  styleId:
                    type: string
                    description: "Napkin AI style identifier"
                  colorMode:
                    type: string
                    description: "Color mode"
                    enum: ["light", "dark", "both"]
                    default: "light"
                  orientation:
                    type: string
                    description: "Visual orientation"
                    enum: ["auto", "horizontal", "vertical", "square"]
                    default: "auto"
              language:
                type: string
                description: "BCP 47 language tag"
                default: "en"
              variations:
                type: integer
                description: "Number of variations to generate"
                minimum: 1
                maximum: 5
                default: 1
              context:
                type: string
                description: "Additional context for generation"
              tenantId:
                type: string
                description: "Tenant ID for multi-tenant isolation"
              apiKeySecretRef:
                type: object
                properties:
                  name:
                    type: string
                    description: "Secret name containing API key"
                  key:
                    type: string
                    description: "Key within secret"
                    default: "NAPKIN_API_KEY"
              storage:
                type: object
                properties:
                  bucket:
                    type: string
                    description: "MinIO bucket name"
                    default: "napkin-visuals"
                  prefix:
                    type: string
                    description: "Object key prefix"
          status:
            type: object
            properties:
              phase:
                type: string
                description: "Current phase of visual generation lifecycle"
                enum: ["Pending", "Submitted", "Processing", "Downloading", "Uploading", "Completed", "Failed"]
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: ["Ready", "Submitted", "Downloaded", "Uploaded"]
                    status:
                      type: string
                      enum: ["True", "False", "Unknown"]
                    lastTransitionTime:
                      type: string
                      format: date-time
                    reason:
                      type: string
                    message:
                      type: string
              napkinRequestId:
                type: string
                description: "Napkin API request ID"
              generatedFiles:
                type: array
                items:
                  type: object
                  properties:
                    index:
                      type: integer
                    format:
                      type: string
                    colorMode:
                      type: string
                    napkinUrl:
                      type: string
                    minioKey:
                      type: string
                    minioUrl:
                      type: string
                    sizeBytes:
                      type: integer
                      format: int64
              startTime:
                type: string
                format: date-time
              completionTime:
                type: string
                format: date-time
              retryCount:
                type: integer
              lastError:
                type: string
              observedGeneration:
                type: integer
                format: int64
    additionalPrinterColumns:
    - name: Format
      type: string
      description: Output format
      jsonPath: .spec.format
    - name: Phase
      type: string
      description: Current phase
      jsonPath: .status.phase
    - name: Files
      type: integer
      description: Number of generated files
      jsonPath: .status.generatedFiles
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
    subresources:
      status: {}
  scope: Namespaced
  names:
    plural: napkinvisuals
    singular: napkinvisual
    kind: NapkinVisual
    shortNames:
    - nv
    categories:
    - napkin
    - tas
